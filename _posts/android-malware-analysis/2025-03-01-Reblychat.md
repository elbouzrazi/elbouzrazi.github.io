---
title: "AridSpy's Advanced Analysis"
classes: wide
header:
teaser: assets/images/malware-analysis/smokeloader/logo.png
ribbon: DodgerBlue
description: "Arid Viper, also known as APT-C-23, Desert Falcons, or Two-tailed Scorpion, is a cyberespionage group that has  been active since at least 2013. Known for targeting countries in the Middle East..."
categories:
- Android Malware Anlysis
tags: [AridSpy]
toc: true
---
# **Introduction**

## **Attack Chain:**

The ReblyChat spyware is part of a multi-stage attack involving a trojanized APK and Firebase as a command-and-control (C&C) server.

`Distribution`: The attack begins with the user downloading a trojanized APK from a malicious website or third-party app store. The user is tricked into manually installing the app.

`First-Stage Payload`: Once installed, the APK executes and connects to a Firebase C&C server to receive commands. This payload downloads and loads the second-stage payload.

`Second-Stage Payload`: The second-stage payload, controlled by the C&C server, exfiltrates sensitive data (e.g., credentials, chat logs) to a file upload C&C server.

`Persistence`: The malware ensures it remains active on the device using background services and evasion techniques.

![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/0.png)

### **ReblyChat Overview:**

Rebly Chat is a malicious Android application leveraged by the **Arid Viper APT group**, a threat actor known for targeting Arabic-speaking users with mobile malware disguised as legitimate application updates. Since at least April 2022, Arid Viper has been observed distributing Rebly Chat as part of its latest campaign, masquerading it as updates for popular messaging applications like WhatsApp, Signal, or Telegram. The group typically lures victims by sharing tutorial videos on platforms like YouTube, which contain links to download the malicious app. The Rebly Chat Trojan was specifically downloaded from the domain **reblychat.com**, which was registered on **April 30th, 2023**.

Rebly Chat is based on the legitimate **Voxer Walkie Talkie Messenger**, a popular communication app. The trojanized version retains much of the original Voxer code but has been modified by the malware developers to include malicious functionality. Key changes include altering the **application icon**, **name**, and **package name** to disguise it as a legitimate update or a new messaging app. Despite these superficial changes, the core spyware capabilities remain intact, allowing it to infiltrate Android devices and exfiltrate sensitive user data to remote servers controlled by the attackers.

Rebly Chat operates as **spyware**, designed to collect a wide range of information, including messages, call logs, device details, and location data. It leverages Google services such as **Firebase** and **Google Analytics** to mask its malicious activities and maintain persistence on the victim's device. By disguising itself as a legitimate chat application update, Rebly Chat demonstrates Arid Viper’s continued reliance on social engineering and trusted platforms to distribute malware and compromise targets.

This report provides an in-depth analysis of Rebly Chat’s functionality, its interaction with Google services, and its role in Arid Viper’s broader campaign, highlighting the evolving tactics of this persistent threat actor.

## Technical analysis

### initial access

The distribution mechanism is very similar for all campaigns supervised by Arid Viper APT group. In order to gain initial access to the device, the threat actors try to convince their potential victim to install a fake, but functional, app. Once the target clicks the site’s Download button, *myScript.js*, hosted on the same server, is executed to generate the correct download file path for the malicious AridSpy. This script makes an AJAX request to *api.php* located on the same server and returns a specific file directory and name.

#### Trojanized messaging applications

Starting chronologically, we will first look at the campaign posing as ReblyChat, a malicious Android application that was available for download from the dedicated *reblychat.com* website. This website was registered on **April 30th, 2023** and is no longer active. Its interface can be seen below.

![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/1.png)

Researchers were able to retrieve additional samples from open directories, including both the clean and trojanized versions of the messaging applications., ReblyChat is based on the legitimate Voxer Walkie Talkie Messenger. the trojanized applications have the same code but the malware developers changed the application icon, name, and package name. the table below list details of the applications retrieved from this server.


| Filename          | Last modified | SHA-1                                    | Description                                                                                                      |
| ----------------- | ------------- | ---------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| rebylchat.apk     | 2023-06-08    | FFDD0E387EB3FEF7CBD2E3DCA5D8924275C3FB94 | The legitimate[Voxer Walkie Talkie Messenger](https://www.voxer.com) application, version 4.0.2.22408 (3669119). |
| rebylchat-old.apk | 2023-06-08    | A64D73C43B41F9A5B938AE8558759ADC474005C1 | The Voxer Walkie Talkie Messenger app trojanized with AridSpy, distributed under the name RebylChat.             |
| rebylchat.apk     | 2023-06-11    | 797073511A15EB85C1E9D8584B26BAA3A0B14C9E |                                                                                                                  |

### Static analysis

- in this section i tried to put the legitimate Voxer talkie walkie apk and the malicious reblychat apk side by side so i can spell the difference. i started by analyzing the **AndroidManifest.xml** that could be used to add some sensitive permissions, add some component like activities , services or broadcast receivers ,and intent filters, then i passed to check for some keywords , and added files that contains the malicious functions responsible for tracking user activities , and collecting user's data.
- ***Key Changes in Reblychat***

**1- Permissions:**
The malware is configured to obtain a number of permissions from the infected device, including the ability to:

- Record audio
- Read contacts
- Read call logs
- Send, receive and read SMS messages
- Access location
- Read phone state
- starting services after the device boots.
- View and change Wi-Fi settings
- Kill background apps
- Read contents of external storage
- Access the camera to take pictures and record video
- Retrieve information on currently running tasks on the device
- Download files without notifications to users
- Create system alerts
- and more...
  These capabilities and the code used to implement them are explored in greater detail below.
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/2.png)
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/3.png)
  as you can see Reblychat share a lot of permissions with the legitimate Voxer application so you can't suspect any malicious behavior based on the permissions, but looking further in the manifest i saw some added permissions :
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/4.png)
  <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES"/>
  <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES"/>
  <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES"/>
  <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES"/>
- *QUERY_ALL_PACKAGES* Allows the malware to get a full list of installed applications, This can be used for reconnaissance, checking for security apps, or identifying vulnerable apps.
- *REQUEST_INSTALL_PACKAGES* This allows the app to install other APKs silently, which could be used to drop additional malware or spyware.
- *INTERNET* While present in both versions, its duplicate mention in the malicious version may indicate an intentional modification, possibly to ensure internet access for exfiltrating data.

**usesCleartextTraffic="true"** (Modified in Malicious App)
![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/5.png)
Allows the app to communicate over unencrypted HTTP, which is insecure and can be used to exfiltrate stolen data in plaintext.

**2- Intent-filters**:

- *ReblyChat* includes wildcards (`*.voxer.com`), which allow it to intercept and manipulate requests targeting different subdomains.
  The legitimate app restricts intent-filters to `www.voxer.com` and `web.voxer.com`, preventing misuse.
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/6.png)

**3- Providers:**

- This **FileProvider** allows the app to share files with other apps securely.
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/7.png)
  The malware author added this so can they **steal private user files**, share them with a remote server, or use them for further exploitation.

**ProcessLifecycleInitializer & WorkManager:**
![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/8.png)

- This **automatically starts background tasks** when the app launches.
- **WorkManagerInitializer** can be used to schedule **persistent background tasks**, such as:
  - **Uploading stolen data** to a remote server.
  - **Exfiltrating messages, contacts, or location data**.
  - **Keeping the malware active even after reboot**.

**4- Broadcast Receivers:**

![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/9.png)

- This **Broadcast Receiver** listens for changes in installed applications.
- It gets triggered when:

  - A new app is installed (`PACKAGE_ADDED`).
  - An app is updated (`PACKAGE_REPLACED`).
  - Any app installation occurs (`PACKAGE_INSTALL`).
  - Any app is modified (`PACKAGE_CHANGED`).
- The modifications observed in the **AndroidManifest.xml**, including additional providers, receivers, and library dependencies, suggest potential malicious functionalities. To further investigate the malware’s behavior, we now analyze the corresponding code implementations and referenced components in the APK's source files

**I- Retrieves System Information:**

- The implant has the ability to get system information from locations such as “/proc/stat“, and from systems services such as “activity”. It will also get memory information from the device using the [StatFs](https://developer.android.com/reference/android/os/StatFs) API which is a wrapper for statvfs() Unix call.
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/10.png)
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/11.png)
- The malware can identify the manufacturer of the device if it is one of the following:
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/12.png)

**II- Record, send and receive calls and SMS messages**

![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/13.png)

The malware can also capture SMS messages received by the device, send new SMS messages, and make calls to phone numbers specified by the C2:
![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/14.png)

**IV- Key Malicious behaviors of ReblyChat:**

- **Obfuscation techniques:**
  *ReblyChat* uses trivial string obfuscation, where each string is declared by converting a character array into a string. the same obfuscation is also applied in the first and second-stage payloads. these two figures shows an example.
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/15.png)
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/16.png)
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/17.png)
- as you can see in the first image we have `https://reblychat.com/apps` API which is used as a distribution site for the Trojanized application *Reblychat* and used further as a C&C communication channel.
- the `index.php & indx.php` endpoints, are used to communicate back and forth with the C&C server, what i noticed that the malware request and send data to these suspected endpoints and likely used to push the first stage into the device's internal storage and that's by creating two files `customer and update.apk` and generally copying the data from *customer* to *update.apk* and finally executing it .

during analysis i discovered  a class named `h.java` which is responsible for the most harmful functions of the Trojan, i will take you throughout the methods used by this class so you can understand what it does exactly:

- **1. Creation and Check for `customer` and `update.apk` Files**

  - **Purpose**: Ensures that the `customer` and `update.apk` files exist in the app's private storage. If they don't exist, the malware may attempt to download or create them.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/18.png)
- **Explanation**:

  - The `a(Context context)` method initializes the `customer` and `update.apk` files by creating `File` objects pointing to their paths in the app's private storage (`context.getFilesDir()`).
  - It checks if the `update.apk` file exists and is valid using `k.a(context.getApplicationContext()).a(e.com_google_services_netwroks)`.
  - If the `update.apk` file is missing or invalid, the code attempts to dismiss any existing dialogs and triggers a callback (`n.a(context, new m() {...})`) to handle the missing file.
  - If the `update.apk` file exists and is valid, the malware proceeds with the decryption and installation process.
- **2. Decryption of Malicious Payload (`update.apk`)**

  - **Purpose**: Decrypts the `customer` file to create the `update.apk` file, which is the
    first-stage payload.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/19.png)
- **Explanation**:

  - The `customer` file is decrypted using AES encryption with a hardcoded key (`e.f.getBytes()`).
  - The decrypted content is written to `update.apk`.
  - If decryption fails, the code attempts to clean up by deleting the files.
- **3. Execution of the Malicious Payload (`update.apk`)**

  - **Purpose**: Installs the decrypted `update.apk` file on the device.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/20.png)
- **Explanation**:

  - The `onClick` method is triggered when the user agrees to install the update.
  - The code creates an intent to install the `update.apk` file using `Intent.ACTION_VIEW`.
  - It handles different Android versions (pre- and post-Android 7.0) to ensure the APK can be installed.
  - If the installation succeeds, the dialog is dismissed, and the malware proceeds to the next stage.
- **4. Removing Files (`Cleanup`)**

  - **Purpose**: Deletes the `customer` and `update.apk` files to avoid detection or reuse.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/21.png)
- **Explanation**:

  - The `b()` method deletes the `customer` and `update.apk` files.
  - This is likely used as part of a cleanup process to remove traces of the malware after the payload has been installed.
- **5. Social Engineering (`Fake Update Prompt`)**

  - **Purpose**: Displays a fake update prompt to trick the user into installing the malicious APK.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/22.png)
- **Explanation**:

  - The `c(Context context)` method displays a dialog prompting the user to update "Google Play services."
  - The dialog is localized (supports Arabic and English) to make it more convincing.
  - If the user agrees, the `onClick` method (from the `a` class) is triggered to install the malicious APK, else both files will be removed.
- **6. Logging and Error Handling**

  - **Purpose**: Logs events and errors for monitoring and debugging purposes.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/23.png)
  - **Explanation**:

    - The `f.a()` method is used throughout the code to log events and errors.
    - These logs might be sent to a remote server or stored locally for debugging purposes.
- **7. Command-and-Control (C2) Communication**

  - **Purpose**: Communicates with a remote server to fetch updates or commands.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/24.png)
- **Explanation**:

  - The `index.php` file is used as part of a C2 mechanism to fetch updates or commands from a remote server.
  - The `customer` file might contain configuration data or commands received from the server.

### Dynamic analysis

After conducting a thorough *static analysis* of the code to identify key malicious behaviors, such as file decryption, payload execution, and social engineering tactics, the next step involves dynamic analysis. This phase focuses on executing the malware in a controlled environment to observe its runtime behavior, including network communication, file system interactions, and system modifications, thereby validating the findings from the static analysis and uncovering additional runtime activities.

**I- File System Interactions:**

- During dynamic analysis, the spyware's interactions with the file system were monitored to validate the findings from the static analysis. The following file accesses were observed:

![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/25.png)

1. **`/data/user/0/com.rebelvox.rebly/files/customer`**:

   - This file corresponds to the **encrypted payload** (`customer`) identified during static analysis.
   - The spyware accesses this file to decrypt it and generate the `update.apk` file, which is the first-stage payload. This behavior aligns with the static analysis findings, where the `a(File file, File file2, Context context)` method was responsible for decrypting `customer` to create `update.apk`.
2. **`/data/user/0/com.rebelvox.rebly/files/update.apk`**:

   - This file is the **decrypted first-stage payload** (`update.apk`) created from the `customer` file.
   - The spyware accesses this file to execute the malicious APK, as observed in the static analysis where the `onClick(DialogInterface dialogInterface, int i)` method was responsible for installing `update.apk`
3. **`/storage/emulated/0/Android/data/com.rebelvox.rebly/cache/LogNet_50`**:

   - This file appears to be a **log file** used by the spyware to record network-related activities, such as HTTP requests, responses, and errors.
   - The presence of this file confirms the spyware's **network communication capabilities**, as identified during static analysis, where the malware was found to communicate with Firebase, Crashlytics, and ReblyChat endpoints.
4. **`/storage/emulated/0`**:

   - This is the **external storage directory**, which the spyware likely accesses to:

     - **Store additional payloads**: The malware may download or create additional files in this directory.
     - **Exfiltrate data**: The spyware may copy stolen data (e.g., user credentials, chat logs) to this directory before transmitting it to the C2 server.

**II- Runtime Behavior and Network Communication**

- In this part the spyware's runtime behavior was monitored using `adb logcat`, and several key activities were observed that align with the findings from the static analysis. Below is a breakdown of some logs and their significance:
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/26.png)
  ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/27.png)
- **Connection to Static Analysis**:

  - **Network Communication**: The logs confirm the spyware's attempts to communicate with Firebase and ReblyChat endpoints, as identified in the static analysis, but encountered an error due to the unavailability of the **Firebase Installations**
  - **Persistence**: The logs reveal the spyware's use of background services to maintain persistence, aligning with the static analysis findings.
  - **Payload Execution**: The log suggests that the spyware may have attempted to freeze or manipulate processes related to `com.google.android.partnersetup`, possibly to avoid detection or to create a stable environment for executing its payload (`update.apk`).
  - **Error Handling**: The logs demonstrate the spyware's ability to handle errors and retry failed connections, consistent with the static analysis.

**II- Network communication:**

- The next step in dynamic analysis was to monitor the spyware's `network activity` to identify any communication with external servers. This is critical because spyware often relies on C2 servers to exfiltrate stolen data (e.g., device information, user credentials) or to receive further instructions.

**Key Observations**:

- **1. C2 Server Communication:**

  - `Firebase as Command-and-Control (C2)`:
  - The spyware used **Firebase** as its primary C2 infrastructure. Firebase, a legitimate cloud service, was abused to send and receive commands, as well as to exfiltrate data.
  - During execution, the spyware sent encrypted payloads to Firebase endpoints, likely containing stolen data such as device information, user credentials, or chat logs.
  - Firebase's real-time database and cloud messaging capabilities were likely exploited to dynamically update the spyware's behavior or deliver additional payloads.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/28.png)
- The app is trying to communicate with Firebase, likely to register the device or fetch configuration data.
- The Firebase server rejected the request because the API key is blocked or invalid.
- `Firebase Initialization Next:`

  - After authentication, the app attempts to register with Firebase to obtain a Firebase Installation ID (FID). This is necessary for Firebase services like Cloud Messaging, Crashlytics, or Realtime Database.
- `Analytics Last:`

  - This request is related to Google Analytics or Firebase Analytics. The app is sending analytics data (e.g., events, user interactions) to Google's measurement service.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/29.png)
- `Updating services `

  - Once open the app, a dialog box of update google-play-services is prompted to the user,
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/37.png)
  - when the user clicks update, a request is sent to decrypt the customer file and move the content into the first stage `update.apk` and a request is sent to update a lot of applications and services, that is potentially important for the functioning of the spyware.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/30.png)
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/31.png)
- `Google analytics request`

  - This request is sending analytics data to Google Analytics. The spyware is likely tracking user behavior, app usage, or other metrics.
  - The spyware uses Google Analytics and Google's measurement services to track user behavior and send data to the attacker's servers.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/32.png)
- **Crash Reporting**:

  - This request is fetching settings from Firebase Crashlytics, a service used for crash reporting and analytics.
  - The spyware is using Firebase Crashlytics to collect crash reports and logs from the victim's device.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/33.png)
- `Requests to the suspected endpoints seen in the static analysis:`

  - The spyware's communication with `index.php` and `indx.php` highlights its reliance on a robust C2 infrastructure for payload delivery, data exfiltration, and command reception.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/34.png)
  - when the user clicks in the `update dialog` it automatically sends a request to this endpoint, which is potentially decrypting the customer file and moves its content into `update.apk`.
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/35.png)
    also in Wireshark i follow the stream of the request and i found out that the spyware is trying to connect to our suspected domain *reblychat.com*
    ![ReblyChat Interface](/assets/images/android-malware-analysis/AridSpy/36.png)

---

### **IoCs(Indicators of compromise)**

**Files:**


| **SHA-1**                                 | **Filename**           | **Detection**         | **Description**                 |
| ----------------------------------------- | ---------------------- | --------------------- | ------------------------------- |
| 797073511A15EB85C1E9 D8584B26BAA3A0B14C9E | com.rebelvox.rebly.apk | Android/Spy.AridSpy.A | AridSpy trojanized application. |
| C999ACE5325B7735255D 9EE2DD782179AE21A673 | update.apk             | Android/Spy.AridSpy.A | The first stage of AridSpy.     |

**Network:**


| IP            | Domain        | Hosting provider | First seen   | Details              |
| ------------- | ------------- | ---------------- | ------------ | -------------------- |
| 23.254.130.97 | reblychat.com | Hostwinds LLC.   | 2023‑05‑01 | Distribution website |

### **MITRE ATT&CK Mapping Summary**


| **Tactic**              | **Technique**                                | **Description**                                                                                                                                           |
| ----------------------- | -------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **InitialAccess**       | Phishing (T1566)                             | Distributed using dedicated websites impersonating legitimate services.<br><br>Uses fake update prompts to trick users into installing malicious updates. |
| **Execution**           | Native API (T1106)                           | Executes malicious payload (`update.apk`) using Android's native APIs.                                                                                    |
| **Persistence**         | Boot or Logon Initialization Scripts (T1037) | Uses background services to ensure persistence after reboots.<br><br>Receives the BOOT_COMPLETED broadcast intent to activate at device startup.          |
| **Defense Evasion**     | Masquerading (T1036)                         | Disguises activities using legitimate services like Firebase and Crashlytics.                                                                             |
| **Defense Evasion**     | Obfuscated Files or Information (T1027)      | Encrypts payload (`customer` file) to evade detection.                                                                                                   |
| **Discovery**           | Software Discovery (T1418)                   | can identify whether Facebook Messenger  installed on a device.                                                                                           |
| **Discovery**           | File and Directory Discovery (T1420)         | Can list files and directories on external storage.                                                                                                       |
| **Discovery**           | System Information Discovery (T1082)         | Gathers device information for exfiltration.                                                                                                              |
| **Discovery**           | Bluetooth Discovery (T1427)                  | Scans for nearby Bluetooth devices to track or spread to other devices.                                                                                   |
| **Collection**          | Data from Local System (T1005)               | Collects data from the infected device for exfiltration.                                                                                                  |
| **Command and Control** | Web Service (T1102)                          | Uses Firebase and ReblyChat endpoints for C2 communication.                                                                                               |
| **Command and Control** | Application Layer Protocol (T1071)           | Uses HTTP/HTTPS for communication with C2 infrastructure.                                                                                                 |
| **Exfiltration**        | Exfiltration Over C2 Channel (T1041)         | Exfiltrates stolen data to the C2 server via`indx.php`.                                                                                                   |
| **Impact**              | Data Encrypted for Impact (T1486)            | Encrypts payload and exfiltrated data for ransom or to prevent detection.                                                                                 |

---

### **Final Thoughts**

The ReblyChat spyware is a highly sophisticated threat that leverages multiple MITRE ATT&CK techniques to infiltrate Android devices, exfiltrate sensitive data, and maintain persistence. By mapping its behavior to the MITRE ATT&CK framework, we can better understand its tactics, techniques, and procedures (TTPs) and develop effective countermeasures to mitigate its impact.
